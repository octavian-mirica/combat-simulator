<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mount Points Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #0f1221;
        --panel: #171a2e;
        --accent: #5ad0ff;
        --text: #e7e9ff;
        --muted: #aab0d3;
        --good: #45c269;
        --warn: #ffb84d;
      }
      body {
        margin: 0;
        padding: 24px;
        background: var(--bg);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          "Helvetica Neue", Arial;
      }
      h1 {
        font-size: 1.6rem;
        margin: 0 0 12px;
      }
      .card {
        background: var(--panel);
        border: 1px solid #262a4a;
        border-radius: 12px;
        padding: 18px;
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.25);
        max-width: 980px;
        margin: 0 auto;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(220px, 1fr));
        gap: 14px;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid #2a2f52;
        border-radius: 10px;
        padding: 12px;
      }
      label {
        font-weight: 600;
        color: var(--muted);
      }
      .sub {
        font-size: 0.9rem;
        color: var(--muted);
      }
      input[type="number"] {
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #31365f;
        background: #0f1330;
        color: var(--text);
        width: 80px;
      }
      input[type="number"]:focus {
        outline: 2px solid var(--accent);
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }
      .btn {
        background: var(--accent);
        color: #081326;
        border: none;
        border-radius: 10px;
        padding: 10px 14px;
        font-weight: 700;
        cursor: pointer;
      }
      .results {
        margin-top: 18px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }
      .stat {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid #2a2f52;
        border-radius: 10px;
        padding: 12px;
      }
      .stat h3 {
        margin: 0 0 8px;
        font-size: 1rem;
        color: var(--muted);
      }
      .value {
        font-size: 1.6rem;
        font-weight: 800;
        color: var(--good);
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        border: 1px solid #2a2f52;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #2a2f52;
      }
      th {
        background: #101536;
        color: var(--muted);
        font-weight: 700;
      }
      .note {
        margin-top: 12px;
        color: var(--muted);
        font-size: 0.9rem;
      }
      .foot {
        margin-top: 18px;
        font-size: 0.9rem;
        color: var(--warn);
      }
      @media (max-width: 860px) {
        .grid {
          grid-template-columns: 1fr;
        }
        .results {
          grid-template-columns: 1fr;
        }
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #171a2e;
        border-bottom: 1px solid #2a2f52;
        padding: 12px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      .title-block {
        display: flex;
        flex-direction: column;
      }
      .topbar .title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #5ad0ff;
      }
      .topbar .subtitle {
        font-size: 0.9rem;
        color: #aab0d3;
        margin-top: 2px;
      }
      .topbar .back-btn {
        background: #5ad0ff;
        color: #081326;
        text-decoration: none;
        font-weight: 600;
        padding: 8px 14px;
        border-radius: 6px;
        transition: background 0.2s, transform 0.2s;
      }
      .topbar .back-btn:hover {
        background: #3bb8e0;
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="topbar">
        <div class="title-block">
          <div class="title">Mounts Points Calculator</div>
          <div class="subtitle">
            You can edit drop chances directly in the table. If you also merge
            the mounts, you should get double the points.
          </div>
        </div>
        <a href="index.html" class="back-btn">⬅ Home</a>
      </div>

      <div class="grid">
        <div class="field">
          <label for="keysToUse">Total keys available to spend</label>
          <input id="keysToUse" type="number" min="0" step="1" value="1000" />
        </div>
        <div class="field">
          <label for="summonCost">Summoning cost (keys per draw)</label>
          <input id="summonCost" type="number" min="1" step="1" value="50" />
        </div>
        <div class="field">
          <label for="extraChance">Extra mount chance per draw (%)</label>
          <input
            id="extraChance"
            type="number"
            min="0"
            max="100"
            step="0.1"
            value="20"
          />
        </div>
      </div>

      <div class="row" style="margin-top: 12px">
        <button class="btn" id="calcBtn">Calculate</button>
        <span class="muted" id="validation"></span>
      </div>

      <div class="results" id="results">
        <div class="stat">
          <h3>Expected totals</h3>
          <div class="value" id="totalPoints">0</div>
          <div class="sub" id="perMountExp"></div>
          <div class="sub" id="drawsSummary"></div>
          <div class="sub" id="mountsSummary"></div>
          <div class="sub" id="keysSummary"></div>
        </div>

        <div class="stat">
          <h3>Expected mounts by rarity</h3>
          <table id="byRarity">
            <thead>
              <tr>
                <th>Rarity</th>
                <th>Drop chance (%)</th>
                <th>Points</th>
                <th>Expected count</th>
                <th>Expected points</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Common</td>
                <td>
                  <input
                    id="chanceCommon"
                    type="number"
                    step="0.1"
                    value="16.5"
                  />
                </td>
                <td>400</td>
                <td id="countCommon">0</td>
                <td id="pointsCommon">0</td>
              </tr>
              <tr>
                <td>Rare</td>
                <td>
                  <input
                    id="chanceRare"
                    type="number"
                    step="0.1"
                    value="16.5"
                  />
                </td>
                <td>600</td>
                <td id="countRare">0</td>
                <td id="pointsRare">0</td>
              </tr>
              <tr>
                <td>Epic</td>
                <td>
                  <input
                    id="chanceEpic"
                    type="number"
                    step="0.1"
                    value="16.5"
                  />
                </td>
                <td>900</td>
                <td id="countEpic">0</td>
                <td id="pointsEpic">0</td>
              </tr>
              <tr>
                <td>Legendary</td>
                <td>
                  <input
                    id="chanceLegendary"
                    type="number"
                    step="0.1"
                    value="16.5"
                  />
                </td>
                <td>1350</td>
                <td id="countLegendary">0</td>
                <td id="pointsLegendary">0</td>
              </tr>
              <tr>
                <td>Ultimate</td>
                <td>
                  <input
                    id="chanceUltimate"
                    type="number"
                    step="0.1"
                    value="28.3"
                  />
                </td>
                <td>2000</td>
                <td id="countUltimate">0</td>
                <td id="pointsUltimate">0</td>
              </tr>
              <tr>
                <td>Mythic</td>
                <td>
                  <input
                    id="chanceMythic"
                    type="number"
                    step="0.1"
                    value="5.7"
                  />
                </td>
                <td>3000</td>
                <td id="countMythic">0</td>
                <td id="pointsMythic">0</td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <th>Total</th>
                <th id="totalChance">100%</th>
                <th>—</th>
                <th id="totalMountsCell">0</th>
                <th id="totalPointsCell">0</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <p class="note">
        Adjust drop chances in the table. They should sum to 100% for accurate
        results.
      </p>
      <p class="foot" id="footNote"></p>
    </div>

    <script>
      const rarities = [
        {
          name: "Common",
          points: 400,
          chanceId: "chanceCommon",
          countId: "countCommon",
          pointsId: "pointsCommon",
        },
        {
          name: "Rare",
          points: 600,
          chanceId: "chanceRare",
          countId: "countRare",
          pointsId: "pointsRare",
        },
        {
          name: "Epic",
          points: 900,
          chanceId: "chanceEpic",
          countId: "countEpic",
          pointsId: "pointsEpic",
        },
        {
          name: "Legendary",
          points: 1350,
          chanceId: "chanceLegendary",
          countId: "countLegendary",
          pointsId: "pointsLegendary",
        },
        {
          name: "Ultimate",
          points: 2000,
          chanceId: "chanceUltimate",
          countId: "countUltimate",
          pointsId: "pointsUltimate",
        },
        {
          name: "Mythic",
          points: 3000,
          chanceId: "chanceMythic",
          countId: "countMythic",
          pointsId: "pointsMythic",
        },
      ];

      function getNumber(id) {
        const v = Number(document.getElementById(id).value);
        return isNaN(v) ? 0 : v;
      }

      function readChances() {
        return rarities.map((r) => ({
          ...r,
          chancePct: getNumber(r.chanceId),
        }));
      }

      function formatInt(n) {
        return Math.round(n).toLocaleString(undefined);
      }
      function formatFloat(n, digits = 2) {
        return Number(n).toLocaleString(undefined, {
          minimumFractionDigits: digits,
          maximumFractionDigits: digits,
        });
      }

      function expectedPointsPerMount(rars) {
        return rars.reduce((sum, r) => sum + (r.chancePct / 100) * r.points, 0);
      }

      function validate(keysToUse, summonCost, extraChance) {
        const messages = [];
        if (isNaN(keysToUse) || keysToUse < 0)
          messages.push("Keys must be 0 or more.");
        if (isNaN(summonCost) || summonCost <= 0)
          messages.push("Summoning cost must be 1 or more.");
        if (isNaN(extraChance) || extraChance < 0 || extraChance > 100)
          messages.push("Extra chance must be between 0 and 100.");
        return messages;
      }

      function calculate() {
        const keysToUse = getNumber("keysToUse");
        const summonCost = getNumber("summonCost");
        const extraChance = getNumber("extraChance");

        const validation = validate(keysToUse, summonCost, extraChance);
        const valEl = document.getElementById("validation");
        if (validation.length) {
          valEl.textContent = validation.join(" ");
          document.getElementById("results").style.display = "none";
          document.getElementById("footNote").textContent = "";
          return;
        } else {
          valEl.textContent = "";
        }

        // Read editable chances
        const rars = readChances();
        const totalChance = rars.reduce(
          (s, r) => s + (isNaN(r.chancePct) ? 0 : r.chancePct),
          0
        );
        document.getElementById("totalChance").textContent = `${formatFloat(
          totalChance,
          1
        )}%`;
        if (Math.abs(totalChance - 100) > 0.001) {
          document.getElementById("validation").textContent =
            "Warning: drop chances do not sum to 100%. Results will be scaled by given percentages.";
        }

        // Draws and expected mounts
        const draws = Math.floor(keysToUse / summonCost);
        const leftoverKeys = keysToUse % summonCost;
        const mountsPerDraw = 1 + extraChance / 100;
        const expectedMountsTotal = draws * mountsPerDraw;

        // Expected points per mount using current chances
        const expPerMount = expectedPointsPerMount(rars);

        // Fill table rows
        let sumExpPoints = 0;
        rars.forEach((r) => {
          const expCount = expectedMountsTotal * (r.chancePct / 100);
          const expPoints = expCount * r.points;
          sumExpPoints += expPoints;

          document.getElementById(r.countId).textContent = formatFloat(
            expCount,
            2
          );
          document.getElementById(r.pointsId).textContent =
            formatInt(expPoints);
        });

        // Totals
        document.getElementById("totalMountsCell").textContent = formatFloat(
          expectedMountsTotal,
          2
        );
        document.getElementById("totalPointsCell").textContent =
          formatInt(sumExpPoints);

        // Header stats
        document.getElementById("totalPoints").textContent =
          formatInt(sumExpPoints);
        document.getElementById(
          "perMountExp"
        ).textContent = `Expected points per mount ≈ ${formatFloat(
          expPerMount,
          2
        )}`;
        document.getElementById(
          "drawsSummary"
        ).textContent = `Usable draws: ${draws} (cost ${summonCost} keys each)`;
        document.getElementById(
          "mountsSummary"
        ).textContent = `Expected mounts: ${formatFloat(
          expectedMountsTotal,
          2
        )} (per draw: ${formatFloat(mountsPerDraw, 2)})`;
        document.getElementById("keysSummary").textContent = `Keys used: ${
          draws * summonCost
        } · Unused keys: ${leftoverKeys}`;

        // Footnote
        document.getElementById(
          "footNote"
        ).textContent = `Quick math: draws = floor(keys / cost) → floor(${formatInt(
          keysToUse
        )} / ${formatInt(summonCost)}) = ${draws}.
         Expected mounts = draws × (1 + bonus%) → ${draws} × ${formatFloat(
          1 + extraChance / 100,
          2
        )} = ${formatFloat(expectedMountsTotal, 2)}.
         Expected points ≈ mounts × points/mount → ${formatFloat(
           expectedMountsTotal,
           2
         )} × ${formatFloat(expPerMount, 2)} = ${formatInt(sumExpPoints)}.`;

        document.getElementById("results").style.display = "grid";
      }

      // Recalculate on changes
      document.getElementById("calcBtn").addEventListener("click", calculate);
      [
        "keysToUse",
        "summonCost",
        "extraChance",
        "chanceCommon",
        "chanceRare",
        "chanceEpic",
        "chanceLegendary",
        "chanceUltimate",
        "chanceMythic",
      ].forEach((id) => {
        const el = document.getElementById(id);
        if (el) el.addEventListener("input", calculate);
      });

      // Initial render
      calculate();
    </script>
  </body>
</html>
